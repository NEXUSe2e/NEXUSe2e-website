<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MessageContext.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ng-nexus-core</a> &gt; <a href="index.source.html" class="el_package">com.evolvsys.nexuse2e.core.message.context</a> &gt; <span class="el_source">MessageContext.java</span></div><h1>MessageContext.java</h1><pre class="source lang-java linenums">package com.evolvsys.nexuse2e.core.message.context;

import com.evolvsys.nexuse2e.core.action.Action;
import com.evolvsys.nexuse2e.core.choreography.model.ContextChoreography;
import com.evolvsys.nexuse2e.core.keyvalue.persistence.PersistentKeyValue;
import com.evolvsys.nexuse2e.core.message.MetaData;
import com.evolvsys.nexuse2e.core.message.generator.ConversationIdGenerator;
import com.evolvsys.nexuse2e.core.message.generator.MessageIdGenerator;
import com.evolvsys.nexuse2e.core.partner.model.ContextPartner;
import com.evolvsys.nexuse2e.core.resolver.validation.*;
import com.evolvsys.nexuse2e.core.route.model.ContextRoute;
import com.evolvsys.nexuse2e.internal.*;
import jakarta.validation.Valid;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.NotNull;
import java.security.cert.X509Certificate;
import java.util.ArrayList;
import java.util.List;
import lombok.*;
import lombok.experimental.Accessors;
import org.springframework.beans.factory.BeanFactory;
import org.springframework.context.ApplicationContext;

/**
 * @author SvenBarden
 * @since 06.10.2023
 */
@Data
@Accessors(chain = true)
@RequiredArgsConstructor(access = AccessLevel.PACKAGE)
@ValidStartAction(
        groups = {MessageContextValidationGroups.Resolver.class, MessageContextValidationGroups.ManualMessage.class})
@ValidNextAction(
        groups = {MessageContextValidationGroups.Resolver.class, MessageContextValidationGroups.ManualMessage.class})
@ValidRoute(
        groups = {MessageContextValidationGroups.Resolver.class, MessageContextValidationGroups.ManualMessage.class})
@ValidConversationState(
        groups = {MessageContextValidationGroups.Resolver.class, MessageContextValidationGroups.ManualMessage.class})
@ValidAcknowledgment(groups = MessageContextValidationGroups.Resolver.class)
public class MessageContext {
    @ToString.Exclude
    private final BeanFactory beanFactory;

    @ToString.Exclude
    private final ApplicationContext applicationContext;

    @ToString.Exclude
    private final MessageIdGenerator messageIdGenerator;

    @ToString.Exclude
    private final ConversationIdGenerator conversationIdGenerator;

    @ToString.Exclude
    private final PersistentKeyValue persistentKeyValue;

    @Getter(AccessLevel.NONE)
    @Setter(AccessLevel.NONE)
    private final LazyObjectStore lazyObjectStore;

    @NotBlank
    private String sourcePartnerId;

    private LazyObject&lt;String, ContextPartner&gt; sourcePartner;

    @NotBlank
    private String targetPartnerId;

    @NotNull
    @Valid
    private Message sourceMessage;

    private Message returnMessage;
    private Message errorMessage;
    private Message acknowledgmentMessage;
    private boolean doReturnPipelines;
    private boolean newContext = true;

    @NotBlank
    private String actionId;

    @NotBlank
    private String choreographyId;

    private final MetaData metaData = new MetaData();
    private final MetaData returnMetaData = new MetaData();

    @NotNull
    private ContextRoute route;

    private final List&lt;ContextPayload&gt; sourceData = new ArrayList&lt;&gt;();

    private ContextPayload returnData;

    private List&lt;ContextPayload&gt; errorData = new ArrayList&lt;&gt;();
    private List&lt;ContextPayload&gt; acknowledgmentData = new ArrayList&lt;&gt;();

    private String sender;

    private List&lt;MessageError&gt; messageErrors = new ArrayList&lt;&gt;();

    private X509Certificate clientCertificate;

    public ExecutionContext createExecutionContext(MessageType messageType) {
<span class="fc" id="L104">        return ContextFactory.createExecutionContext(this, messageType);</span>
    }

    public void setErrorData(ContextPayload contextPayload) {
<span class="nc" id="L108">        this.errorData.clear();</span>
<span class="nc" id="L109">        this.errorData.add(contextPayload);</span>
<span class="nc" id="L110">    }</span>

    public void setSourceData(ContextPayload contextPayload) {
<span class="fc" id="L113">        this.sourceData.clear();</span>
<span class="fc" id="L114">        this.sourceData.add(contextPayload);</span>
<span class="fc" id="L115">    }</span>

    public void setAcknowledgmentData(ContextPayload contextPayload) {
<span class="fc" id="L118">        this.acknowledgmentData.clear();</span>
<span class="fc" id="L119">        this.acknowledgmentData.add(contextPayload);</span>
<span class="fc" id="L120">    }</span>

    public Action getAction() {
<span class="fc" id="L123">        return lazyObjectStore.getAction(this);</span>
    }

    public ContextPartner getSourcePartner() {
<span class="fc" id="L127">        return lazyObjectStore.getSourcePartner(this);</span>
    }

    public ContextPartner getTargetPartner() {
<span class="fc" id="L131">        return lazyObjectStore.getTargetPartner(this);</span>
    }

    public ContextChoreography getChoreography() {
<span class="fc" id="L135">        return lazyObjectStore.getChoreography(this);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>