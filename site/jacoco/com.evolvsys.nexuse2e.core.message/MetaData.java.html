<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MetaData.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ng-nexus-core</a> &gt; <a href="index.source.html" class="el_package">com.evolvsys.nexuse2e.core.message</a> &gt; <span class="el_source">MetaData.java</span></div><h1>MetaData.java</h1><pre class="source lang-java linenums">package com.evolvsys.nexuse2e.core.message;

import com.evolvsys.nexuse2e.core.constants.Constant;
import com.evolvsys.nexuse2e.core.exception.NexusError;
import com.evolvsys.nexuse2e.core.exception.NexusRuntimeException;
import java.util.*;
import java.util.stream.Collectors;
import lombok.EqualsAndHashCode;
import lombok.ToString;
import lombok.extern.slf4j.Slf4j;
import one.util.streamex.StreamEx;
import org.apache.commons.collections4.CollectionUtils;
import org.springframework.lang.Nullable;

/**
 * @author SvenBarden
 * @since 13.10.2023
 */
@ToString
@EqualsAndHashCode
<span class="fc" id="L21">@Slf4j</span>
@SuppressWarnings({&quot;PMD.GodClass&quot;, &quot;PMD.ExcessivePublicCount&quot;})
<span class="fc" id="L23">public class MetaData {</span>
    public static final String DEFAULT_CATEGORY = &quot;default&quot;;
    private static final String UNUSED = &quot;unused&quot;;

<span class="fc" id="L27">    private final Map&lt;String, Map&lt;String, List&lt;Object&gt;&gt;&gt; data = new LinkedHashMap&lt;&gt;();</span>

    /**
     * Overrides this metadata with the values from the parameter.
     *
     * @param metaData metadata values to set
     */
    public void set(MetaData metaData) {
<span class="fc" id="L35">        data.clear();</span>
<span class="fc" id="L36">        data.putAll(metaData.data);</span>
<span class="fc" id="L37">    }</span>

    /**
     * Adds all metadata values from the parameter to this metadata.
     *
     * @param metaData metadata values to add
     * @return this metadata object
     */
    public MetaData add(MetaData metaData) {
<span class="fc bfc" id="L46" title="All 2 branches covered.">        for (Map.Entry&lt;String, Map&lt;String, List&lt;Object&gt;&gt;&gt; categoryEntry : metaData.data.entrySet()) {</span>
            for (Map.Entry&lt;String, List&lt;Object&gt;&gt; entry :
<span class="fc bfc" id="L48" title="All 2 branches covered.">                    categoryEntry.getValue().entrySet()) {</span>
<span class="fc" id="L49">                addAll(categoryEntry.getKey(), entry.getKey(), entry.getValue());</span>
<span class="fc" id="L50">            }</span>
<span class="fc" id="L51">        }</span>
<span class="fc" id="L52">        return this;</span>
    }

    /**
     * Copies the metadata to a new object. It creates a shallow copy, so all objects references stay the same.
     *
     * @return copied metadata
     */
    public MetaData copy() {
<span class="fc" id="L61">        MetaData copy = new MetaData();</span>

<span class="fc bfc" id="L63" title="All 2 branches covered.">        for (Map.Entry&lt;String, Map&lt;String, List&lt;Object&gt;&gt;&gt; entry : data.entrySet()) {</span>
            for (Map.Entry&lt;String, List&lt;Object&gt;&gt; categoryEntry :
<span class="fc bfc" id="L65" title="All 2 branches covered.">                    entry.getValue().entrySet()) {</span>
<span class="fc" id="L66">                copy.set(entry.getKey(), categoryEntry.getKey(), categoryEntry.getValue());</span>
<span class="fc" id="L67">            }</span>
<span class="fc" id="L68">        }</span>

<span class="fc" id="L70">        return copy;</span>
    }

    // get - List&lt;T&gt;

    /**
     * Gets the metadata values as an &lt;b&gt;unmodifiable&lt;/b&gt; List for a category and a key.
     *
     * @param category the category
     * @param key      the metadata key
     * @param &lt;T&gt;      Expected metadata value type
     * @return metadata values
     * @see #get(String, Constant)
     * @see #get(String, String, Class)
     */
    public &lt;T&gt; List&lt;T&gt; get(String category, String key) {
        //noinspection unchecked
<span class="fc" id="L87">        return (List&lt;T&gt;) Collections.unmodifiableList(</span>
<span class="fc" id="L88">                data.getOrDefault(category, Collections.emptyMap()).getOrDefault(key, Collections.emptyList()));</span>
    }

    /**
     * Gets the metadata values as an &lt;b&gt;unmodifiable&lt;/b&gt; List for a category and a key.
     *
     * @param category the category
     * @param key      the metadata key
     * @param type     Expected metadata value type
     * @param &lt;T&gt;      Expected metadata value type
     * @return metadata values
     * @see #get(String, String)
     */
    public &lt;T&gt; List&lt;T&gt; get(String category, String key, @SuppressWarnings(UNUSED) Class&lt;T&gt; type) {
<span class="fc" id="L102">        return get(category, key);</span>
    }

    /**
     * Gets the metadata values as an &lt;b&gt;unmodifiable&lt;/b&gt; List for a category and a constant key.
     *
     * @param category the category
     * @param constant the constant key
     * @param &lt;T&gt;      Expected metadata value type
     * @return metadata values
     * @see #get(String, String)
     */
    public &lt;T&gt; List&lt;T&gt; get(String category, Constant&lt;T&gt; constant) {
<span class="fc" id="L115">        return get(category, constant.getName());</span>
    }

    /**
     * Gets the metadata values as an &lt;b&gt;unmodifiable&lt;/b&gt; List for the default category ({@value DEFAULT_CATEGORY}) and a key.
     *
     * @param key the metadata key
     * @param &lt;T&gt; Expected metadata value type
     * @return metadata values
     * @see #get(String, Class)
     * @see #get(Constant)
     */
    public &lt;T&gt; List&lt;T&gt; get(String key) {
<span class="fc" id="L128">        return get(DEFAULT_CATEGORY, key);</span>
    }

    /**
     * Gets the metadata values as an &lt;b&gt;unmodifiable&lt;/b&gt; List for the default category ({@value DEFAULT_CATEGORY}).
     *
     * @param key  the metadata key
     * @param type Expected metadata value type
     * @param &lt;T&gt;  Expected metadata value type
     * @return metadata values
     * @see #get(String)
     * @see #get(Constant)
     */
    public &lt;T&gt; List&lt;T&gt; get(String key, @SuppressWarnings(UNUSED) Class&lt;T&gt; type) {
<span class="fc" id="L142">        return get(key);</span>
    }

    /**
     * Gets the metadata values as an &lt;b&gt;unmodifiable&lt;/b&gt; List for the default category ({@value DEFAULT_CATEGORY}) and a constant key.
     *
     * @param constant the constant key
     * @param &lt;T&gt;      Expected metadata value type
     * @return metadata values
     * @see #get(String)
     */
    public &lt;T&gt; List&lt;T&gt; get(Constant&lt;T&gt; constant) {
<span class="fc" id="L154">        return get(constant.getName());</span>
    }

    // getAll

    /**
     * Gets the metadata values as an &lt;b&gt;unmodifiable&lt;/b&gt; List for &lt;b&gt;all categories&lt;/b&gt; and a key.
     *
     * @param key the metadata key
     * @param &lt;T&gt; Expected metadata value type
     * @return metadata values
     * @see #getAll(String, Class)
     * @see #getAll(Constant)
     */
    public &lt;T&gt; List&lt;T&gt; getAll(String key) {
        //noinspection unchecked
<span class="fc" id="L170">        return (List&lt;T&gt;) StreamEx.of(data.values())</span>
<span class="fc" id="L171">                .toFlatList(stringListMap -&gt; stringListMap.getOrDefault(key, new ArrayList&lt;&gt;()));</span>
    }

    /**
     * Gets the metadata values as an &lt;b&gt;unmodifiable&lt;/b&gt; List for &lt;b&gt;all categories&lt;/b&gt; and a key.
     *
     * @param key  the metadata key
     * @param type Expected metadata value type
     * @param &lt;T&gt;  Expected metadata value type
     * @return metadata values
     * @see #getAll(String)
     * @see #getAll(Constant)
     */
    public &lt;T&gt; List&lt;T&gt; getAll(String key, @SuppressWarnings(UNUSED) Class&lt;T&gt; type) {
<span class="fc" id="L185">        return getAll(key);</span>
    }

    /**
     * Gets the metadata values as an &lt;b&gt;unmodifiable&lt;/b&gt; List for &lt;b&gt;all categories&lt;/b&gt; and a constant key.
     *
     * @param constant the constant key
     * @param &lt;T&gt;      Expected metadata value type
     * @return metadata values
     * @see #getAll(String)
     */
    public &lt;T&gt; List&lt;T&gt; getAll(Constant&lt;T&gt; constant) {
<span class="fc" id="L197">        return getAll(constant.getName());</span>
    }

    // getFirst - Optional&lt;T&gt;

    /**
     * Gets the first value from a list of values
     *
     * @param list the list
     * @param &lt;T&gt;  the value type
     * @return the value
     */
    private &lt;T&gt; Optional&lt;T&gt; getFirstFromList(List&lt;T&gt; list) {
        Optional&lt;T&gt; result;
<span class="fc bfc" id="L211" title="All 2 branches covered.">        if (CollectionUtils.isEmpty(list)) {</span>
<span class="fc" id="L212">            result = Optional.empty();</span>
        } else {
<span class="fc" id="L214">            result = Optional.ofNullable(list.getFirst());</span>
        }
<span class="fc" id="L216">        return result;</span>
    }

    /**
     * Gets the first value for a category and key
     *
     * @param category the category
     * @param key      the key
     * @param &lt;T&gt;      the value type
     * @return the value
     * @see #getFirst(String, Constant)
     * @see #getFirst(String, String, Class)
     */
    public &lt;T&gt; Optional&lt;T&gt; getFirst(String category, String key) {
<span class="fc" id="L230">        return getFirstFromList(get(category, key));</span>
    }

    /**
     * Gets the first value for a category and key
     *
     * @param category the category
     * @param key      the key
     * @param type     the value type
     * @param &lt;T&gt;      the value type
     * @return the value
     * @see #get(String, String)
     * @see #getFirst(String, Constant)
     */
    public &lt;T&gt; Optional&lt;T&gt; getFirst(String category, String key, Class&lt;T&gt; type) {
<span class="fc" id="L245">        return getFirstFromList(get(category, key, type));</span>
    }

    /**
     * Gets the first value for a category and constant key
     *
     * @param category the category
     * @param constant the constant key
     * @param &lt;T&gt;      the value type
     * @return the value
     * @see #getFirst(String, String)
     */
    public &lt;T&gt; Optional&lt;T&gt; getFirst(String category, Constant&lt;T&gt; constant) {
<span class="fc" id="L258">        return getFirst(category, constant.getName());</span>
    }

    /**
     * Gets the first value for the default category ({@value DEFAULT_CATEGORY}) and a key.
     *
     * @param key the key
     * @param &lt;T&gt; the value type
     * @return the value
     * @see #getFirst(Constant)
     * @see #getFirst(String, Class)
     */
    public &lt;T&gt; Optional&lt;T&gt; getFirst(String key) {
<span class="fc" id="L271">        return getFirstFromList(get(key));</span>
    }

    /**
     * Gets the first value for the default category ({@value DEFAULT_CATEGORY}) and a key.
     *
     * @param key  the key
     * @param type the value type
     * @param &lt;T&gt;  the value type
     * @return the value
     * @see #getFirst(Constant)
     * @see #getFirst(String)
     */
    public &lt;T&gt; Optional&lt;T&gt; getFirst(String key, Class&lt;T&gt; type) {
<span class="fc" id="L285">        return getFirstFromList(get(key, type));</span>
    }

    /**
     * Gets the first value for the default category ({@value DEFAULT_CATEGORY}) and a constant key.
     *
     * @param constant the constant key
     * @param &lt;T&gt;      the value type
     * @return the value
     * @see #getFirst(String)
     */
    public &lt;T&gt; Optional&lt;T&gt; getFirst(Constant&lt;T&gt; constant) {
<span class="fc" id="L297">        return getFirst(constant.getName());</span>
    }

    // getAllFirst - Optional&lt;T&gt;

    /**
     * Gets the first value for a key. The value from the first category containing the key will be used.
     *
     * @param key the key
     * @param &lt;T&gt; the value type
     * @return the value
     * @see #getAllFirst(Constant)
     * @see #getAllFirst(String, Class)
     */
    public &lt;T&gt; Optional&lt;T&gt; getAllFirst(String key) {
<span class="fc" id="L312">        return getFirstFromList(getAll(key));</span>
    }

    /**
     * Gets the first value for a key. The value from the first category containing the key will be used.
     *
     * @param key  the key
     * @param type the value type
     * @param &lt;T&gt;  the value type
     * @return the value
     * @see #getAllFirst(Constant)
     * @see #getAllFirst(String)
     */
    public &lt;T&gt; Optional&lt;T&gt; getAllFirst(String key, Class&lt;T&gt; type) {
<span class="fc" id="L326">        return getFirstFromList(getAll(key, type));</span>
    }

    /**
     * Gets the first value for a constant key. The value from the first category containing the constant key will be used.
     *
     * @param constant the constant key
     * @param &lt;T&gt;      the value type
     * @return the value
     * @see #getAllFirst(String)
     */
    public &lt;T&gt; Optional&lt;T&gt; getAllFirst(Constant&lt;T&gt; constant) {
<span class="fc" id="L338">        return getAllFirst(constant.getName());</span>
    }

    // getFirstOrDefault - T

    /**
     * Gets the first value for a category and key. If no value is found, the defaultValue will be returned.
     *
     * @param category     the category
     * @param key          the key
     * @param defaultValue the default value to use
     * @param &lt;T&gt;          the value type
     * @return the value
     * @see #getFirstOrNull(String, String)
     * @see #getFirstOrDefault(String, Constant, Object)
     */
    public &lt;T&gt; T getFirstOrDefault(String category, String key, T defaultValue) {
<span class="fc" id="L355">        Optional&lt;T&gt; value = getFirst(category, key);</span>
<span class="fc" id="L356">        return value.orElse(defaultValue);</span>
    }

    /**
     * Gets the first value for a category and constant key. If no value is found, the defaultValue will be returned.
     *
     * @param category     the category
     * @param constant     the constant key
     * @param defaultValue the default value to use
     * @param &lt;T&gt;          the value type
     * @return the value
     * @see #getFirstOrNull(String, Constant)
     * @see #getFirstOrDefault(String, String, Object)
     */
    public &lt;T&gt; T getFirstOrDefault(String category, Constant&lt;T&gt; constant, T defaultValue) {
<span class="fc" id="L371">        return getFirstOrDefault(category, constant.getName(), defaultValue);</span>
    }

    /**
     * Gets the first value for the default category ({@value DEFAULT_CATEGORY}) and a key.
     * If no value is found, the defaultValue will be returned.
     *
     * @param key          the key
     * @param defaultValue the default value to use
     * @param &lt;T&gt;          the value type
     * @return the value
     * @see #getFirstOrNull(String)
     * @see #getFirstOrDefault(Constant, Object)
     */
    public &lt;T&gt; T getFirstOrDefault(String key, T defaultValue) {
<span class="fc" id="L386">        Optional&lt;T&gt; value = getFirst(key);</span>
<span class="fc" id="L387">        return value.orElse(defaultValue);</span>
    }

    /**
     * Gets the first value for the default category ({@value DEFAULT_CATEGORY}) and a constant key.
     * If no value is found, the defaultValue will be returned.
     *
     * @param constant     the constant key
     * @param defaultValue the default value to use
     * @param &lt;T&gt;          the value type
     * @return the value
     * @see #getFirstOrNull(Constant)
     * @see #getFirstOrDefault(String, Object)
     */
    public &lt;T&gt; T getFirstOrDefault(Constant&lt;T&gt; constant, T defaultValue) {
<span class="fc" id="L402">        return getFirstOrDefault(constant.getName(), defaultValue);</span>
    }

    // getAllFirstOrDefault - T

    /**
     * Gets the first value for a key. The value from the first category containing the key will be used.
     * If no value is found, the defaultValue will be returned.
     *
     * @param key          the key
     * @param defaultValue the default value to use
     * @param &lt;T&gt;          the value type
     * @return the value
     * @see #getAllFirstOrNull(String)
     * @see #getAllFirstOrDefault(Constant, Object)
     */
    public &lt;T&gt; T getAllFirstOrDefault(String key, T defaultValue) {
<span class="fc" id="L419">        Optional&lt;T&gt; value = getAllFirst(key);</span>
<span class="fc" id="L420">        return value.orElse(defaultValue);</span>
    }

    /**
     * Gets the first value for a constant key. The value from the first category containing the constant key will be used.
     * If no value is found, the defaultValue will be returned.
     *
     * @param constant     the constant key
     * @param defaultValue the default value to use
     * @param &lt;T&gt;          the value type
     * @return the value
     * @see #getAllFirstOrNull(Constant)
     * @see #getAllFirstOrDefault(String, Object)
     */
    public &lt;T&gt; T getAllFirstOrDefault(Constant&lt;T&gt; constant, T defaultValue) {
<span class="fc" id="L435">        return getAllFirstOrDefault(constant.getName(), defaultValue);</span>
    }

    // getFirstOrNull - T

    /**
     * Gets the first value for a category and key or {@code null} if no value was found.
     *
     * @param category the category
     * @param key      the key
     * @param &lt;T&gt;      the value type
     * @return the value
     * @see #getFirstOrNull(String, Constant)
     * @see #getFirstOrNull(String, String, Class)
     */
    @Nullable
    public &lt;T&gt; T getFirstOrNull(String category, String key) {
        //noinspection unchecked
<span class="fc" id="L453">        return (T) getFirst(category, key).orElse(null);</span>
    }

    /**
     * Gets the first value for a category and key or {@code null} if no value was found.
     *
     * @param category the category
     * @param key      the key
     * @param type     the value type
     * @param &lt;T&gt;      the value type
     * @return the value
     * @see #getFirstOrNull(String, String)
     * @see #getFirstOrNull(String, Constant)
     */
    @Nullable
    public &lt;T&gt; T getFirstOrNull(String category, String key, @SuppressWarnings(UNUSED) Class&lt;T&gt; type) {
<span class="fc" id="L469">        return getFirstOrNull(category, key);</span>
    }

    /**
     * Gets the first value for a category and constant key or {@code null} if no value was found.
     *
     * @param category the category
     * @param constant the constant key
     * @param &lt;T&gt;      the value type
     * @return the value
     * @see #getFirstOrNull(String, String)
     */
    @Nullable
    public &lt;T&gt; T getFirstOrNull(String category, Constant&lt;T&gt; constant) {
<span class="fc" id="L483">        return getFirstOrNull(category, constant.getName());</span>
    }

    /**
     * Gets the first value for the default category ({@value DEFAULT_CATEGORY}) and a key or {@code null} if no value was found.
     *
     * @param key the key
     * @param &lt;T&gt; the value type
     * @return the value
     * @see #getFirstOrNull(Constant)
     * @see #getFirstOrNull(String, Class)
     */
    @Nullable
    public &lt;T&gt; T getFirstOrNull(String key) {
        //noinspection unchecked
<span class="fc" id="L498">        return (T) getFirst(key).orElse(null);</span>
    }

    /**
     * Gets the first value for the default category ({@value DEFAULT_CATEGORY}) and a key or {@code null} if no value was found.
     *
     * @param key  the key
     * @param type the value type
     * @param &lt;T&gt;  the value type
     * @return the value
     * @see #getFirstOrNull(String)
     * @see #getFirstOrNull(Constant)
     */
    @Nullable
    public &lt;T&gt; T getFirstOrNull(String key, @SuppressWarnings(UNUSED) Class&lt;T&gt; type) {
<span class="fc" id="L513">        return getFirstOrNull(key);</span>
    }

    /**
     * Gets the first value for the default category ({@value DEFAULT_CATEGORY}) and a constant key or {@code null} if no value was found.
     *
     * @param constant the constant key
     * @param &lt;T&gt;      the value type
     * @return the value
     * @see #getFirstOrNull(String)
     */
    @Nullable
    public &lt;T&gt; T getFirstOrNull(Constant&lt;T&gt; constant) {
<span class="fc" id="L526">        return getFirstOrNull(constant.getName());</span>
    }

    // getAllFirstOrNull - T

    /**
     * Gets the first value for a key or {@code null} if no value was found.
     * The value from the first category containing the key will be used.
     *
     * @param key the key
     * @param &lt;T&gt; the value type
     * @return the value
     * @see #getAllFirstOrNull(Constant)
     * @see #getAllFirstOrNull(String, Class)
     */
    @Nullable
    public &lt;T&gt; T getAllFirstOrNull(String key) {
        //noinspection unchecked
<span class="fc" id="L544">        return (T) getAllFirst(key).orElse(null);</span>
    }

    /**
     * Gets the first value for a key or {@code null} if no value was found.
     * The value from the first category containing the key will be used.
     *
     * @param key  the key
     * @param type the value type
     * @param &lt;T&gt;  the value type
     * @return the value
     * @see #getAllFirstOrNull(String)
     * @see #getAllFirstOrNull(Constant)
     */
    @Nullable
    public &lt;T&gt; T getAllFirstOrNull(String key, @SuppressWarnings(UNUSED) Class&lt;T&gt; type) {
<span class="fc" id="L560">        return getAllFirstOrNull(key);</span>
    }

    /**
     * Gets the first value for a constant key or {@code null} if no value was found.
     * The value from the first category containing the key will be used.
     *
     * @param constant the constant key
     * @param &lt;T&gt;      the value type
     * @return the value
     * @see #getAllFirstOrNull(String)
     */
    @Nullable
    public &lt;T&gt; T getAllFirstOrNull(Constant&lt;T&gt; constant) {
<span class="fc" id="L574">        return getAllFirstOrNull(constant.getName());</span>
    }

    // getFirstOrThrows - T

    /**
     * Gets the first value for a category and key or throws an exception if no value was found.
     *
     * @param category the category
     * @param key      the key
     * @param &lt;T&gt;      the value type
     * @return the value
     * @see #getFirstOrThrows(String, Constant)
     * @see #getFirstOrThrows(String, String, Class)
     */
    public &lt;T&gt; T getFirstOrThrows(String category, String key) {
<span class="fc" id="L590">        Optional&lt;T&gt; value = getFirst(category, key);</span>
<span class="fc" id="L591">        return value.orElseThrow(() -&gt; new NexusRuntimeException(NexusError.builder()</span>
<span class="fc" id="L592">                .message(&quot;No metaData with key &quot; + key + &quot; in category &quot; + category + &quot; found&quot;)</span>
<span class="fc" id="L593">                .extension(&quot;key&quot;, key)</span>
<span class="fc" id="L594">                .extension(&quot;category&quot;, category)</span>
<span class="fc" id="L595">                .build()));</span>
    }

    /**
     * Gets the first value for a category and key or throws an exception if no value was found.
     *
     * @param category the category
     * @param key      the key
     * @param type     the value type
     * @param &lt;T&gt;      the value type
     * @return the value
     * @see #getFirstOrThrows(String, Constant)
     * @see #getFirstOrThrows(String, String)
     */
    public &lt;T&gt; T getFirstOrThrows(String category, String key, @SuppressWarnings(UNUSED) Class&lt;T&gt; type) {
<span class="fc" id="L610">        return getFirstOrThrows(category, key);</span>
    }

    /**
     * Gets the first value for a category and constant key or throws an exception if no value was found.
     *
     * @param category the category
     * @param constant the constant key
     * @param &lt;T&gt;      the value type
     * @return the value
     * @see #getFirstOrThrows(String, String)
     */
    public &lt;T&gt; T getFirstOrThrows(String category, Constant&lt;T&gt; constant) {
<span class="fc" id="L623">        return getFirstOrThrows(category, constant.getName());</span>
    }

    /**
     * Gets the first value for the default category ({@value DEFAULT_CATEGORY}) and a key or throws an exception if no value was found.
     *
     * @param key the key
     * @param &lt;T&gt; the value type
     * @return the value
     * @see #getFirstOrThrows(Constant)
     * @see #getFirstOrThrows(String, Class)
     */
    public &lt;T&gt; T getFirstOrThrows(String key) {
<span class="fc" id="L636">        Optional&lt;T&gt; value = getFirst(key);</span>
<span class="fc" id="L637">        return value.orElseThrow(() -&gt; new NexusRuntimeException(NexusError.builder()</span>
<span class="fc" id="L638">                .message(&quot;No metaData with key &quot; + key + &quot; found&quot;)</span>
<span class="fc" id="L639">                .extension(&quot;key&quot;, key)</span>
<span class="fc" id="L640">                .build()));</span>
    }

    /**
     * Gets the first value for the default category ({@value DEFAULT_CATEGORY}) and a key or throws an exception if no value was found.
     *
     * @param key  the key
     * @param type the value type
     * @param &lt;T&gt;  the value type
     * @return the value
     * @see #getFirstOrThrows(String)
     * @see #getFirstOrThrows(Constant)
     */
    public &lt;T&gt; T getFirstOrThrows(String key, @SuppressWarnings(UNUSED) Class&lt;T&gt; type) {
<span class="fc" id="L654">        return getFirstOrThrows(key);</span>
    }

    /**
     * Gets the first value for the default category ({@value DEFAULT_CATEGORY}) and a constant key or throws an exception if no value was found.
     *
     * @param constant the constant key
     * @param &lt;T&gt;      the value type
     * @return the value
     * @see #getFirstOrThrows(String)
     */
    public &lt;T&gt; T getFirstOrThrows(Constant&lt;T&gt; constant) {
<span class="fc" id="L666">        return getFirstOrThrows(constant.getName());</span>
    }

    // getAllFirstOrThrows - T

    /**
     * Gets the first value for a key or throws an exception if no value was found.
     * The value from the first category containing the key will be used.
     *
     * @param key the key
     * @param &lt;T&gt; the value type
     * @return the value
     * @see #getAllFirstOrThrows(Constant)
     * @see #getAllFirstOrThrows(String, Class)
     */
    public &lt;T&gt; T getAllFirstOrThrows(String key) {
<span class="fc" id="L682">        Optional&lt;T&gt; value = getAllFirst(key);</span>
<span class="fc" id="L683">        return value.orElseThrow(() -&gt; new NexusRuntimeException(NexusError.builder()</span>
<span class="fc" id="L684">                .message(&quot;No metaData with key &quot; + key + &quot; found&quot;)</span>
<span class="fc" id="L685">                .extension(&quot;key&quot;, key)</span>
<span class="fc" id="L686">                .build()));</span>
    }

    /**
     * Gets the first value for a key or throws an exception if no value was found.
     * The value from the first category containing the key will be used.
     *
     * @param key  the key
     * @param type the value type
     * @param &lt;T&gt;  the value type
     * @return the value
     * @see #getAllFirstOrThrows(String)
     * @see #getAllFirstOrThrows(Constant)
     */
    public &lt;T&gt; T getAllFirstOrThrows(String key, @SuppressWarnings(UNUSED) Class&lt;T&gt; type) {
<span class="fc" id="L701">        return getAllFirstOrThrows(key);</span>
    }

    /**
     * Gets the first value for a constant key or throws an exception if no value was found.
     * The value from the first category containing the constant key will be used.
     *
     * @param constant the constant key
     * @param &lt;T&gt;      the value type
     * @return the value
     * @see #getAllFirstOrThrows(String)
     */
    public &lt;T&gt; T getAllFirstOrThrows(Constant&lt;T&gt; constant) {
<span class="fc" id="L714">        return getAllFirstOrThrows(constant.getName());</span>
    }

    // add - T

    /**
     * Adds a value to a metadata key for a category.
     * If the category or key does not already exist, they will be created.
     * If {@code value} is {@code null} the metadata will not change.
     *
     * @param category the category
     * @param key      the key
     * @param value    the value
     * @return the current metadata
     * @see #add(String, Constant, Object)
     */
    public MetaData add(String category, String key, @Nullable Object value) {
<span class="pc bpc" id="L731" title="1 of 2 branches missed.">        if (value != null) {</span>
<span class="fc" id="L732">            data.computeIfAbsent(category, s -&gt; new LinkedHashMap&lt;&gt;())</span>
<span class="fc" id="L733">                    .computeIfAbsent(key, s -&gt; new ArrayList&lt;&gt;())</span>
<span class="fc" id="L734">                    .add(value);</span>
        }
<span class="fc" id="L736">        return this;</span>
    }

    /**
     * Adds a value to a metadata constant key for a category.
     * If the category or key does not already exist, they will be created.
     * If {@code value} is {@code null} the metadata will not change.
     *
     * @param category the category
     * @param constant the constant key
     * @param value    the value
     * @param &lt;T&gt;      the value type
     * @return the current metadata
     * @see #add(String, String, Object)
     */
    public &lt;T&gt; MetaData add(String category, Constant&lt;T&gt; constant, @Nullable T value) {
<span class="fc" id="L752">        return add(category, constant.getName(), value);</span>
    }

    /**
     * Adds a value to a metadata key for the default category ({@value #DEFAULT_CATEGORY}).
     * If {@code value} is {@code null} the metadata will not change.
     *
     * @param key   the key
     * @param value the value
     * @return the current metadata
     * @see #add(Constant, Object)
     */
    public MetaData add(String key, @Nullable Object value) {
<span class="fc bfc" id="L765" title="All 2 branches covered.">        if (value != null) {</span>
<span class="fc" id="L766">            data.computeIfAbsent(DEFAULT_CATEGORY, s -&gt; new LinkedHashMap&lt;&gt;())</span>
<span class="fc" id="L767">                    .computeIfAbsent(key, s -&gt; new ArrayList&lt;&gt;())</span>
<span class="fc" id="L768">                    .add(value);</span>
        }
<span class="fc" id="L770">        return this;</span>
    }

    /**
     * Adds a value to a metadata constant key for the default category ({@value #DEFAULT_CATEGORY}).
     * If {@code value} is {@code null} the metadata will not change.
     *
     * @param constant the constant key
     * @param value    the value
     * @param &lt;T&gt;      the value type
     * @return the current metadata
     * @see #add(String, Object)
     */
    public &lt;T&gt; MetaData add(Constant&lt;T&gt; constant, @Nullable T value) {
<span class="fc" id="L784">        return add(constant.getName(), value);</span>
    }

    // addAll - T

    /**
     * Adds all the values from the list to a metadata key for the default category ({@value #DEFAULT_CATEGORY}).
     * If {@code values} is {@code null}, the metadata will not change.
     *
     * @param key    the key
     * @param values the values
     * @return the current metadata
     * @see #addAll(String, String, List)
     */
    public &lt;T&gt; MetaData addAll(String key, @Nullable List&lt;T&gt; values) {
<span class="fc" id="L799">        return addAll(DEFAULT_CATEGORY, key, values);</span>
    }

    /**
     * Adds all the values from the list to a metadata constant key for the default category ({@value #DEFAULT_CATEGORY}).
     * If {@code values} is {@code null}, the metadata will not change.
     *
     * @param constant the constant key
     * @param values   the values
     * @return the current metadata
     * @see #addAll(String, List)
     */
    public &lt;T&gt; MetaData addAll(Constant&lt;T&gt; constant, @Nullable List&lt;T&gt; values) {
<span class="nc" id="L812">        return addAll(constant.getName(), values);</span>
    }

    /**
     * Adds all the values from the list for the metadata key for the given category.
     * If the category does not exist, a new one will be created.
     * If {@code values} is {@code null}, the metadata will not change.
     *
     * @param category the category
     * @param key      the key
     * @param values   the values
     * @return the current metadata
     * @see #addAll(String, Constant, List)
     */
    public &lt;T&gt; MetaData addAll(String category, String key, @Nullable List&lt;T&gt; values) {
<span class="fc bfc" id="L827" title="All 2 branches covered.">        if (values != null) {</span>
<span class="fc" id="L828">            data.computeIfAbsent(category, s -&gt; new LinkedHashMap&lt;&gt;())</span>
<span class="fc" id="L829">                    .computeIfAbsent(key, s -&gt; new ArrayList&lt;&gt;())</span>
<span class="fc" id="L830">                    .addAll(values);</span>
        }
<span class="fc" id="L832">        return this;</span>
    }

    /**
     * Adds all the values from the list for the metadata constant key for the given category.
     * If the category does not exist, a new one will be created.
     * If {@code values} is {@code null}, the metadata will not change.
     *
     * @param category the categoy
     * @param constant the constant key
     * @param values   the values
     * @return the current metadata
     * @see #addAll(String, String, List)
     */
    public &lt;T&gt; MetaData addAll(String category, Constant&lt;T&gt; constant, @Nullable List&lt;T&gt; values) {
<span class="nc" id="L847">        return addAll(category, constant.getName(), values);</span>
    }

    // set - T

    /**
     * Sets the values to a metadata key for a category.
     * The collection will be copied in a new list, to prevent modification.
     * If {@code values} is {@code null} an empty collection will be set as value.
     *
     * @param category the category
     * @param key      the key
     * @param values   the values
     * @return the current metadata
     * @see #set(String, Constant, Collection)
     * @see #set(String, String, Object)
     */
    public MetaData set(String category, String key, @Nullable Collection&lt;?&gt; values) {
        List&lt;Object&gt; list;
<span class="pc bpc" id="L866" title="1 of 2 branches missed.">        if (values == null) {</span>
<span class="nc" id="L867">            list = new ArrayList&lt;&gt;();</span>
        } else {
<span class="fc" id="L869">            list = new ArrayList&lt;&gt;(values);</span>
        }
<span class="fc" id="L871">        data.computeIfAbsent(category, s -&gt; new LinkedHashMap&lt;&gt;()).put(key, list);</span>
<span class="fc" id="L872">        return this;</span>
    }

    /**
     * Sets the values to a metadata key for a category.
     * The collection will be copied in a new list, to prevent modification.
     * If {@code values} is {@code null} an empty collection will be set as value.
     *
     * @param category the category
     * @param key      the key
     * @param values   the values
     * @return the current metadata
     * @see #set(String, Constant, Collection)
     * @see #set(String, String, Object)
     */
    public MetaData set(String category, String key, @Nullable Object[] values) {
<span class="pc bpc" id="L888" title="1 of 2 branches missed.">        if (values == null) {</span>
<span class="nc" id="L889">            set(category, key, List.of());</span>
        } else {
<span class="fc" id="L891">            set(category, key, Arrays.asList(values));</span>
        }
<span class="fc" id="L893">        return this;</span>
    }

    /**
     * Sets the values to a metadata constant key for a category.
     * The collection will be copied in a new list, to prevent modification.
     * If {@code values} is {@code null} an empty collection will be set as value.
     *
     * @param category the category
     * @param key      the constant key
     * @param values   the values
     * @return the current metadata
     * @see #set(String, Constant, Collection)
     * @see #set(String, String, Object)
     */
    public &lt;T&gt; MetaData set(String category, Constant&lt;T&gt; key, @Nullable T[] values) {
<span class="nc bnc" id="L909" title="All 2 branches missed.">        if (values == null) {</span>
<span class="nc" id="L910">            set(category, key, List.of());</span>
        } else {
<span class="nc" id="L912">            set(category, key, Arrays.asList(values));</span>
        }
<span class="nc" id="L914">        return this;</span>
    }

    /**
     * Sets a single value to a metadata key for a category.
     * If {@code values} is {@code null} an empty collection will be set as value.
     *
     * @param category the category
     * @param key      the key
     * @param value    the value
     * @return the current metadata
     * @see #set(String, String, Collection)
     * @see #set(String, Constant, Object)
     */
    public MetaData set(String category, String key, @Nullable Object value) {
<span class="fc bfc" id="L929" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L930">            set(category, key, List.of());</span>
<span class="fc bfc" id="L931" title="All 2 branches covered.">        } else if (value instanceof Collection&lt;?&gt; collection) {</span>
<span class="fc" id="L932">            set(category, key, collection);</span>
<span class="fc bfc" id="L933" title="All 2 branches covered.">        } else if (value.getClass().isArray()) {</span>
<span class="fc" id="L934">            set(category, key, Arrays.asList((Object[]) value));</span>
        } else {
<span class="fc" id="L936">            set(category, key, List.of(value));</span>
        }
<span class="fc" id="L938">        return this;</span>
    }

    /**
     * Sets the values to a metadata constant key for a category.
     * The collection will be copied in a new list, to prevent modification.
     * If {@code values} is {@code null} an empty collection will be set as value.
     *
     * @param category the category
     * @param constant the constant key
     * @param values   the values
     * @param &lt;T&gt;      the value type
     * @return the current metadata
     * @see #set(String, String, Collection)
     * @see #set(String, Constant, Object)
     */
    public &lt;T&gt; MetaData set(String category, Constant&lt;T&gt; constant, @Nullable Collection&lt;T&gt; values) {
<span class="nc" id="L955">        return set(category, constant.getName(), values);</span>
    }

    /**
     * Sets a single value to a metadata constant key for a category.
     * If {@code values} is {@code null} an empty collection will be set as value.
     *
     * @param category the category
     * @param constant the constant key
     * @param value    the value
     * @param &lt;T&gt;      the value type
     * @return the current metadata
     * @see #set(String, String, Object)
     * @see #set(String, Constant, Collection)
     */
    public &lt;T&gt; MetaData set(String category, Constant&lt;T&gt; constant, @Nullable T value) {
<span class="fc" id="L971">        return set(category, constant.getName(), value);</span>
    }

    /**
     * Sets the values to a metadata key for the default category ({@value #DEFAULT_CATEGORY}).
     * The collection will be copied in a new list, to prevent modification.
     * If {@code values} is {@code null} an empty collection will be set as value.
     *
     * @param key    the key
     * @param values the values
     * @return the current metadata
     * @see #set(String, Object)
     * @see #set(Constant, Collection)
     */
    public MetaData set(String key, @Nullable Collection&lt;?&gt; values) {
<span class="fc" id="L986">        return set(DEFAULT_CATEGORY, key, values);</span>
    }

    /**
     * Sets a single value to a metadata key for the default category ({@value #DEFAULT_CATEGORY}).
     * If {@code values} is {@code null} an empty collection will be set as value.
     *
     * @param key   the key
     * @param value the value
     * @return the current metadata
     * @see #set(Constant, Object)
     * @see #set(String, Collection)
     */
    public MetaData set(String key, @Nullable Object value) {
<span class="fc" id="L1000">        return set(DEFAULT_CATEGORY, key, value);</span>
    }

    /**
     * Sets a single value to a metadata constant key for the default category ({@value #DEFAULT_CATEGORY}).
     * If {@code values} is {@code null} an empty collection will be set as value.
     *
     * @param constant the constant key
     * @param value    the value
     * @param &lt;T&gt;      the value type
     * @return the current metadata
     * @see #set(String, Object)
     * @see #set(Constant, Collection)
     */
    public &lt;T&gt; MetaData set(Constant&lt;T&gt; constant, @Nullable T value) {
<span class="fc" id="L1015">        return set(constant.getName(), value);</span>
    }

    /**
     * Sets the values to a metadata constant key for the default category ({@value #DEFAULT_CATEGORY}).
     * The collection will be copied in a new list, to prevent modification.
     * If {@code values} is {@code null} an empty collection will be set as value.
     *
     * @param constant the constant key
     * @param values   the values
     * @param &lt;T&gt;      the value type
     * @return the current metadata
     * @see #set(String, Collection)
     * @see #set(Constant, Object)
     */
    public &lt;T&gt; MetaData set(Constant&lt;T&gt; constant, @Nullable Collection&lt;T&gt; values) {
<span class="nc" id="L1031">        return set(constant.getName(), values);</span>
    }

    /**
     * Set of metadata keys for a category
     *
     * @param category the category
     * @return Set of metadata keys for a category
     */
    public Set&lt;String&gt; keys(String category) {
<span class="fc" id="L1041">        return data.computeIfAbsent(category, s -&gt; new LinkedHashMap&lt;&gt;()).keySet();</span>
    }

    /**
     * Set of all metadata keys from all categories
     *
     * @return Set of all metadata keys
     */
    public Set&lt;String&gt; keys() {
<span class="fc" id="L1050">        return StreamEx.of(data.values())</span>
<span class="fc" id="L1051">                .flatMap(stringListMap -&gt; stringListMap.keySet().stream())</span>
<span class="fc" id="L1052">                .collect(Collectors.toUnmodifiableSet());</span>
    }

    /**
     * Set of all categories
     *
     * @return Set of all categories
     */
    public Set&lt;String&gt; categories() {
<span class="fc" id="L1061">        return data.keySet();</span>
    }

    /**
     * Clears metadata for a category
     *
     * @param category the category
     */
    public void clear(String category) {
<span class="fc" id="L1070">        data.remove(category);</span>
<span class="fc" id="L1071">    }</span>

    /**
     * Clears all metadata
     */
    public void clear() {
<span class="fc" id="L1077">        data.clear();</span>
<span class="fc" id="L1078">    }</span>

    /**
     * Checks if a category has a value for a key
     *
     * @param category the category
     * @param key      the key
     * @return has a value
     */
    public boolean hasKey(String category, String key) {
<span class="fc" id="L1088">        return data.getOrDefault(category, Collections.emptyMap()).containsKey(key);</span>
    }

    /**
     * Checks if a category has a value for a constant key
     *
     * @param category the category
     * @param key      the constant key
     * @return has a value
     */
    public boolean hasKey(String category, Constant&lt;?&gt; key) {
<span class="fc" id="L1099">        return hasKey(category, key.getName());</span>
    }

    /**
     * Checks if the default category ({@value #DEFAULT_CATEGORY}) has a value for a key
     *
     * @param key the key
     * @return has a value
     */
    public boolean hasKey(String key) {
<span class="fc" id="L1109">        return hasKey(DEFAULT_CATEGORY, key);</span>
    }

    /**
     * Checks if the default category ({@value #DEFAULT_CATEGORY}) has a value for a constant key
     *
     * @param key the constant key
     * @return has a value
     */
    public boolean hasKey(Constant&lt;?&gt; key) {
<span class="fc" id="L1119">        return hasKey(DEFAULT_CATEGORY, key);</span>
    }

    /**
     * Checks if any category has a value for a key
     *
     * @param key the key
     * @return has a value
     */
    public boolean hasAnyKey(String key) {
<span class="fc" id="L1129">        return keys().contains(key);</span>
    }

    /**
     * Checks if any category has a value for a constant key
     *
     * @param key the constant key
     * @return has a value
     */
    public boolean hasAnyKey(Constant&lt;?&gt; key) {
<span class="nc" id="L1139">        return keys().contains(key.getName());</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>